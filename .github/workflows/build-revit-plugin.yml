name: Build Revit DA Plugin

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Restore and build
      run: |
        msbuild RoomMaker.csproj /p:Configuration=Release /restore

    - name: Create AppBundle folder
      run: |
        mkdir RoomMaker.bundle
        mkdir RoomMaker.bundle/Contents
        copy bin\Release\RoomMaker.dll RoomMaker.bundle\Contents\
        copy RoomMaker.addin RoomMaker.bundle\Contents\
        copy PackageContents.xml RoomMaker.bundle\

    - name: Zip AppBundle
      run: |
        powershell Compress-Archive -Path RoomMaker.bundle -DestinationPath RoomMaker.bundle.zip

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: RoomMakerBundle
        path: RoomMaker.bundle.zip
